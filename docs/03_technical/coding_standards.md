# Daifugo ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

## ç›®çš„

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Daifugoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆå¤§å¯Œè±ªã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ï¼‰ã«ãŠã‘ã‚‹é–‹ç™ºè¦ç´„ã‚’å®šç¾©ã—ã¾ã™ã€‚

## å…±é€šã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

**åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±é€šã®è¦ç´„ã«å¾“ã£ã¦ãã ã•ã„ï¼š**

ğŸ“– **[å…±é€šã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã®å…¨ä½“åƒ](coding_standards/README.md)** - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã€ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—åˆ¥ã‚¬ã‚¤ãƒ‰

### Coreè¦ç´„

- **[å‘½åè¦å‰‡](coding_standards/core/naming-conventions.md)** - ã‚¯ãƒ©ã‚¹ã€å¤‰æ•°ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘½åãƒ«ãƒ¼ãƒ«
- **[ã‚³ãƒ¼ãƒ‰æ§‹æˆ](coding_standards/core/code-organization.md)** - ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã€ã‚¯ãƒ©ã‚¹è¨­è¨ˆ
- **[ã‚³ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](coding_standards/core/comments-documentation.md)** - XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€Tooltip
- **[ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](coding_standards/core/error-handling.md)** - nullå®‰å…¨æ€§ã€Try-Catch
- **[ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹](coding_standards/core/performance.md)** - Updateæœ€é©åŒ–ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **[Unityå›ºæœ‰](coding_standards/core/unity-specifics.md)** - Time.deltaTimeã€RequireComponent

### Architectureè¦ç´„

- **[ScriptableObject](coding_standards/architecture/scriptableobject.md)** - ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³
- **[EventChannel](coding_standards/architecture/event-channels.md)** - ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•é€šä¿¡
- **[Variables](coding_standards/architecture/variables.md)** - ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¤‰æ•°ç®¡ç†
- **[RuntimeSet](coding_standards/architecture/runtime-sets.md)** - å‹•çš„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
- **[ä¾å­˜é–¢ä¿‚ç®¡ç†](coding_standards/architecture/dependency-management.md)** - å„ªå…ˆé †ä½ã¨å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- **[æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³](coding_standards/architecture/extension-patterns.md)** - æ–°æ©Ÿèƒ½è¿½åŠ ãƒ•ãƒ­ãƒ¼

### UIè¦ç´„

- **[BEMå‘½å](coding_standards/ui/ui-toolkit/bem-naming.md)** - UI Toolkitã‚¯ãƒ©ã‚¹åè¦å‰‡
- **[ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³](coding_standards/ui/ui-toolkit/design-tokens.md)** - USSå¤‰æ•°æ´»ç”¨
- **[UXMLæ§‹é€ ](coding_standards/ui/ui-toolkit/uxml-structure.md)** - UIæ§‹é€ è¨­è¨ˆ
- **[ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–](coding_standards/ui/ui-toolkit/uss-responsive.md)** - ç”»é¢è§£åƒåº¦å¯¾å¿œ
- **[World Space UI](coding_standards/ui/ugui/world-space-ui.md)** - 3Dç©ºé–“UIãƒ‘ã‚¿ãƒ¼ãƒ³
- **[Billboard](coding_standards/ui/ugui/billboard.md)** - ã‚«ãƒ¡ãƒ©è¿½å¾“UI
- **[uGUI Best Practices](coding_standards/ui/ugui/best-practices.md)** - uGUIå®Ÿè£…è¦ç´„

### ã‚³ãƒ¼ãƒ‰ä¾‹

- **[è‰¯ã„ä¾‹: EventChannel](coding_standards/examples/good/event-channel-example.cs)**
- **[è‰¯ã„ä¾‹: ScriptableObject](coding_standards/examples/good/scriptableobject-example.cs)**
- **[è‰¯ã„ä¾‹: Variables](coding_standards/examples/good/variable-example.cs)**
- **[ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³: Singletonä¹±ç”¨](coding_standards/examples/anti-patterns/singleton-abuse.cs)**
- **[ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³: Updateé‡ã„å‡¦ç†](coding_standards/examples/anti-patterns/update-heavy.cs)**

---

## Daifugoå›ºæœ‰ã®è¦ç´„

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç‰¹æ€§

- **ã‚·ãƒ³ã‚°ãƒ«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿèƒ½ãªã—
- **2D â†’ 3Dæ®µéšé–‹ç™º**: Phase 1ã¯2Dï¼ˆUI Toolkitï¼‰ã€Phase 2ã¯3Dï¼ˆæ¼”å‡ºå¼·åŒ–ï¼‰
- **ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ **: å¤§å¯Œè±ªã®ãƒ«ãƒ¼ãƒ«å®Ÿè£…
- **å­¦ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: UI Toolkitã€ScriptableObjectã€EventChannelãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¿’å¾—

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### Phase 1ï¼ˆ2Dç‰ˆï¼‰
- Unity UI Toolkit 100%
- Tang3cko.EventChannels
- ScriptableObject
- Spriteç”»åƒ

#### Phase 2ï¼ˆ3Dç‰ˆï¼‰
- Unity 3D URP
- UI Toolkitï¼ˆHUDéƒ¨åˆ†ï¼‰
- LitMotionï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- Cinemachineï¼ˆã‚«ãƒ¡ãƒ©ãƒ¯ãƒ¼ã‚¯ï¼‰
- Particle Systemï¼ˆæ¼”å‡ºï¼‰

---

## Namespaceè¦ç´„

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«åŸºã¥ãNamespace

```csharp
namespace Daifugo.Core      // ã‚²ãƒ¼ãƒ ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
namespace Daifugo.Data      // ScriptableObjectå®šç¾©
namespace Daifugo.Events    // EventChannelå®šç¾©
namespace Daifugo.UI        // UIé–¢é€£
namespace Daifugo.AI        // AIå‡¦ç†
```

### å®Ÿè£…ä¾‹

```csharp
using UnityEngine;
using Tang3cko.EventChannels;

namespace Daifugo.Core
{
    public class GameManager : MonoBehaviour
    {
        // ...
    }
}

namespace Daifugo.UI
{
    public class GameScreenUI : MonoBehaviour
    {
        // ...
    }
}
```

---

## CreateAssetMenuå‘½åè¦å‰‡

Daifugoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®å‘½åè¦å‰‡ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```csharp
// ãƒ‡ãƒ¼ã‚¿ç³»
[CreateAssetMenu(fileName = "Card", menuName = "Daifugo/Data/Card")]
[CreateAssetMenu(fileName = "Deck", menuName = "Daifugo/Data/Deck")]

// RuntimeSetç³»
[CreateAssetMenu(fileName = "PlayerRuntimeSet", menuName = "Daifugo/RuntimeSet/Player")]

// EventChannelç³»
[CreateAssetMenu(fileName = "CardEventChannel", menuName = "Daifugo/Events/Card Event Channel")]
[CreateAssetMenu(fileName = "VoidEventChannel", menuName = "Daifugo/Events/Void Event Channel")]
```

**ãƒ‘ã‚¿ãƒ¼ãƒ³:**
- ãƒ‡ãƒ¼ã‚¿ç³»: `"Daifugo/Data/ã‚«ãƒ†ã‚´ãƒª"`
- RuntimeSetç³»: `"Daifugo/RuntimeSet/å‹å"`
- EventChannelç³»: `"Daifugo/Events/å‹å Event Channel"`

---

## ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ç‰¹æœ‰ã®å®Ÿè£…

### CardSOã®å®šç¾©

```csharp
using UnityEngine;

namespace Daifugo.Data
{
    /// <summary>
    /// ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸å¤‰ï¼‰
    /// </summary>
    [CreateAssetMenu(fileName = "Card", menuName = "Daifugo/Data/Card")]
    public class CardSO : ScriptableObject
    {
        [Header("Card Properties")]
        public Suit suit;           // ã‚¹ãƒšãƒ¼ãƒ‰ã€ãƒãƒ¼ãƒˆã€ãƒ€ã‚¤ãƒ¤ã€ã‚¯ãƒ©ãƒ–
        public int rank;            // 1-13ï¼ˆ1=A, 11=J, 12=Q, 13=Kï¼‰

        [Header("Visual")]
        public Sprite cardSprite;   // 2Dç‰ˆã§ä½¿ç”¨
        public Material cardMaterial; // 3Dç‰ˆã§ä½¿ç”¨ï¼ˆPhase 2ï¼‰

        /// <summary>
        /// ã‚«ãƒ¼ãƒ‰ã®å¼·ã•ã‚’å–å¾—ï¼ˆå¤§å¯Œè±ªãƒ«ãƒ¼ãƒ«ï¼‰
        /// </summary>
        public int GetStrength()
        {
            // 2 > A > K > ... > 3
            if (rank == 2) return 15;
            if (rank == 1) return 14;
            return rank;
        }

        public enum Suit
        {
            Spade,
            Heart,
            Diamond,
            Club
        }
    }
}
```

### DeckSOã®å®šç¾©

```csharp
using UnityEngine;
using System.Collections.Generic;

namespace Daifugo.Data
{
    /// <summary>
    /// ãƒ‡ãƒƒã‚­ç®¡ç†ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼‰
    /// </summary>
    [CreateAssetMenu(fileName = "Deck", menuName = "Daifugo/Data/Deck")]
    public class DeckSO : ScriptableObject
    {
        [SerializeField] private List<CardSO> allCards; // 52æšã®ã‚«ãƒ¼ãƒ‰
        private List<CardSO> deck = new List<CardSO>();

        public void Initialize()
        {
            deck.Clear();
            deck.AddRange(allCards);
            Shuffle();
        }

        public void Shuffle()
        {
            for (int i = 0; i < deck.Count; i++)
            {
                int randomIndex = Random.Range(i, deck.Count);
                (deck[i], deck[randomIndex]) = (deck[randomIndex], deck[i]);
            }
        }

        public CardSO DrawCard()
        {
            if (deck.Count == 0) return null;
            CardSO card = deck[0];
            deck.RemoveAt(0);
            return card;
        }

        public int RemainingCards => deck.Count;
    }
}
```

### CardDragManipulatorå®Ÿè£…

```csharp
using UnityEngine;
using UnityEngine.UIElements;
using Tang3cko.EventChannels;

namespace Daifugo.UI
{
    /// <summary>
    /// ã‚«ãƒ¼ãƒ‰ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ“ä½œï¼ˆPhase 1 - UI Toolkitï¼‰
    /// </summary>
    public class CardDragManipulator : PointerManipulator
    {
        private Vector3 startPosition;
        private CardSO cardData;
        private CardEventChannelSO onCardPlayed;

        public CardDragManipulator(CardSO card, CardEventChannelSO eventChannel)
        {
            cardData = card;
            onCardPlayed = eventChannel;
        }

        protected override void RegisterCallbacksOnTarget()
        {
            target.RegisterCallback<PointerDownEvent>(OnPointerDown);
            target.RegisterCallback<PointerMoveEvent>(OnPointerMove);
            target.RegisterCallback<PointerUpEvent>(OnPointerUp);
        }

        protected override void UnregisterCallbacksFromTarget()
        {
            target.UnregisterCallback<PointerDownEvent>(OnPointerDown);
            target.UnregisterCallback<PointerMoveEvent>(OnPointerMove);
            target.UnregisterCallback<PointerUpEvent>(OnPointerUp);
        }

        private void OnPointerDown(PointerDownEvent evt)
        {
            startPosition = target.transform.position;
            target.CapturePointer(evt.pointerId);
            target.AddToClassList("card--selected");
            evt.StopPropagation();
        }

        private void OnPointerMove(PointerMoveEvent evt)
        {
            if (target.HasPointerCapture(evt.pointerId))
            {
                Vector3 delta = new Vector3(evt.deltaPosition.x, evt.deltaPosition.y, 0);
                target.transform.position += delta;
            }
        }

        private void OnPointerUp(PointerUpEvent evt)
        {
            if (target.HasPointerCapture(evt.pointerId))
            {
                target.ReleasePointer(evt.pointerId);
                target.RemoveFromClassList("card--selected");

                // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®åˆ¤å®š
                if (IsOverPlayArea(evt.position))
                {
                    // EventChannelç™ºç«
                    onCardPlayed?.RaiseEvent(cardData);
                }
                else
                {
                    // å…ƒã®ä½ç½®ã«æˆ»ã™
                    target.transform.position = startPosition;
                }
            }
        }

        private bool IsOverPlayArea(Vector2 position)
        {
            VisualElement fieldArea = target.panel.visualTree.Q<VisualElement>("FieldCardsContainer");
            if (fieldArea == null) return false;
            return fieldArea.worldBound.Contains(position);
        }
    }
}
```

---

## Phaseåˆ¥ã®è¦ç´„

### Phase 1ï¼ˆ2Dç‰ˆï¼‰ç‰¹æœ‰

- **UI Toolkit 100%ä½¿ç”¨**
- USSã§ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
- PointerManipulatorã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- Spriteç”»åƒã§ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- BEMå‘½åè¦å‰‡ã®å³å®ˆ

### Phase 2ï¼ˆ3Dç‰ˆï¼‰ç‰¹æœ‰

- **Phase 1ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æµç”¨**
- UI Toolkitï¼ˆHUDéƒ¨åˆ†ã®ã¿ï¼‰
- LitMotionã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- Cinemachineã§ã‚«ãƒ¡ãƒ©ãƒ¯ãƒ¼ã‚¯
- Material/Textureã§ã‚«ãƒ¼ãƒ‰è¡¨ç¾

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### ScriptableObjecté…ç½®

```
Assets/_Project/ScriptableObjects/
â”œâ”€â”€ Cards/                  # 52æšã®CardSO
â”‚   â”œâ”€â”€ Spades/
â”‚   â”œâ”€â”€ Hearts/
â”‚   â”œâ”€â”€ Diamonds/
â”‚   â””â”€â”€ Clubs/
â”‚
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ Deck.asset
â”‚   â””â”€â”€ PlayerHand.asset
â”‚
â”œâ”€â”€ EventChannels/
â”‚   â”œâ”€â”€ OnGameStarted.asset
â”‚   â”œâ”€â”€ OnCardPlayed.asset
â”‚   â””â”€â”€ OnTurnChanged.asset
â”‚
â”œâ”€â”€ Variables/
â”‚   â”œâ”€â”€ CurrentTurnIndex.asset
â”‚   â”œâ”€â”€ SelectedCardCount.asset
â”‚   â””â”€â”€ IsRevolutionActive.asset
â”‚
â””â”€â”€ RuntimeSets/
    â””â”€â”€ PlayerSet.asset
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆé…ç½®

```
Assets/_Project/Scripts/
â”œâ”€â”€ Core/                  # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPhase 1/2å…±é€šï¼‰
â”‚   â”œâ”€â”€ GameManager.cs
â”‚   â”œâ”€â”€ TurnManager.cs
â”‚   â”œâ”€â”€ RuleValidator.cs
â”‚   â””â”€â”€ AIPlayer.cs
â”‚
â”œâ”€â”€ Data/                  # ScriptableObjectå®šç¾©
â”‚   â”œâ”€â”€ CardSO.cs
â”‚   â”œâ”€â”€ DeckSO.cs
â”‚   â””â”€â”€ PlayerHandSO.cs
â”‚
â”œâ”€â”€ Events/                # EventChannelå®šç¾©
â”‚   â”œâ”€â”€ CardEventChannelSO.cs
â”‚   â”œâ”€â”€ IntEventChannelSO.cs
â”‚   â””â”€â”€ VoidEventChannelSO.cs
â”‚
â””â”€â”€ UI/                    # UIå±¤
    â”œâ”€â”€ 2D/                # Phase 1
    â”‚   â”œâ”€â”€ GameScreenUI.cs
    â”‚   â”œâ”€â”€ CardUI.cs
    â”‚   â””â”€â”€ HandUI.cs
    â””â”€â”€ 3D/                # Phase 2
        â”œâ”€â”€ Card3D.cs
        â””â”€â”€ Hand3D.cs
```

---

## ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- [ ] ScriptableObjectã®é©åˆ‡ãªä½¿ç”¨
- [ ] EventChannelã«ã‚ˆã‚‹ç–çµåˆ
- [ ] RuntimeSetã«ã‚ˆã‚‹å‹•çš„ç®¡ç†
- [ ] å˜ä¸€è²¬ä»»ã®åŸå‰‡ã®éµå®ˆ
- [ ] Namespaceè¦ç´„ã®éµå®ˆï¼ˆ`Daifugo.*`ï¼‰

### UI Toolkitï¼ˆPhase 1ï¼‰

- [ ] BEMå‘½åè¦å‰‡ã®éµå®ˆ
- [ ] USSå¤‰æ•°ã®æ´»ç”¨
- [ ] PointerManipulatorã®é©åˆ‡ãªå®Ÿè£…
- [ ] UXML/USSã®åˆ†é›¢

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- [ ] Updateå†…ã®é‡ã„å‡¦ç†ã®å›é¿
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã®å®Ÿè£…
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•è¨­è¨ˆ

### æ™‚é–“å‡¦ç†

- [ ] Time.deltaTimeã®é©åˆ‡ãªä½¿ç”¨
- [ ] ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆç‹¬ç«‹è¨­è¨ˆ

### å“è³ª

- [ ] nullå®‰å…¨æ€§ã®ç¢ºä¿ï¼ˆ`?.`æ¼”ç®—å­ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…
- [ ] é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›
- [ ] XMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¼‰

---

## å‚è€ƒè³‡æ–™

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[å…±é€šã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](coding_standards/)** - å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±é€šã®ãƒ«ãƒ¼ãƒ«
- **[SpecKit](../00_spec/)** - ä»•æ§˜é§†å‹•é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](../01_overview/)** - Daifugoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒ

### å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹

- **Unity UI Toolkit**: https://docs.unity3d.com/Manual/UIElements.html
- **Tang3cko.EventChannels**: EventChannelãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- **LitMotion**: https://github.com/AnnulusGames/LitMotion
- **Cinemachine**: https://docs.unity3d.com/Packages/com.unity.cinemachine@latest
